# Created by newuser for 5.9
# Set the directory we want to store zinit and plugins
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"

# Download Zinit, if it's not there yet
if [ ! -d "$ZINIT_HOME" ]; then
    mkdir -p "$(dirname $ZINIT_HOME)"
    git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
fi

# Source/Load zinit
source "${ZINIT_HOME}/zinit.zsh"

# Add in Powerlevel10k
zinit ice depth=1; zinit light romkatv/powerlevel10k

# Add in zsh plugins
zinit light zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-completions
zinit light zsh-users/zsh-autosuggestions
zinit light Aloxaf/fzf-tab

# Add in snippets
zinit snippet OMZL::git.zsh
zinit snippet OMZP::git
zinit snippet OMZP::sudo
zinit snippet OMZP::archlinux
zinit snippet OMZP::aws
zinit snippet OMZP::kubectl
zinit snippet OMZP::kubectx
zinit snippet OMZP::helm
zinit snippet OMZP::command-not-found

# Load completions
autoload -Uz compinit && compinit

zinit cdreplay -q

# AWS CLI completion
if command -v aws_completer &>/dev/null; then
    complete -C aws_completer aws
fi

# Helm completion
if command -v helm &>/dev/null; then
    source <(helm completion zsh)
fi

# Kubectl completion
if command -v kubectl &>/dev/null; then
    source <(kubectl completion zsh)
    compdef __start_kubectl k
fi

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Keybindings
bindkey -e  # Use emacs key bindings

# History navigation
bindkey '^p' history-search-backward
bindkey '^n' history-search-forward

# Word navigation (Ctrl + Left/Right Arrow)
bindkey '^[[1;5C' forward-word      # Ctrl + Right Arrow
bindkey '^[[1;5D' backward-word     # Ctrl + Left Arrow

# Alt + Left/Right Arrow (alternative)
bindkey '^[[1;3C' forward-word      # Alt + Right Arrow
bindkey '^[[1;3D' backward-word     # Alt + Left Arrow

# Additional useful keybindings
bindkey '^[w' kill-region           # Alt + w: delete region
bindkey '^[[H' beginning-of-line    # Home key
bindkey '^[[F' end-of-line          # End key
bindkey '^[[3~' delete-char         # Delete key
bindkey '^?' backward-delete-char   # Backspace key

# History
HISTSIZE=5000
HISTFILE=~/.zsh_history
SAVEHIST=$HISTSIZE
HISTDUP=erase
setopt appendhistory
setopt sharehistory
setopt hist_ignore_space
setopt hist_ignore_all_dups
setopt hist_save_no_dups
setopt hist_ignore_dups
setopt hist_find_no_dups

# Completion styling
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
zstyle ':completion:*' menu no
zstyle ':completion:*:descriptions' format '[%d]'
zstyle ':completion:*:git-checkout:*' sort false

# fzf-tab configuration
zstyle ':fzf-tab:*' switch-group ',' '.'
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'ls --color $realpath'
zstyle ':fzf-tab:complete:__zoxide_z:*' fzf-preview 'ls --color $realpath'

# Aliases

# ls/eza aliases (modern ls replacement if you have it)
alias ls='ls --color'
alias ll='ls -lh'
alias la='ls -lAh'
alias l='ls -CF'
alias lt='ls -lht'  # sort by time

# Navigation
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias ~='cd ~'
alias -- -='cd -'  # go back to previous directory

# Kubernetes (enhance the k alias you already have)
alias k='kubectl'
alias kgp='kubectl get pods'
alias kgs='kubectl get svc'
alias kgd='kubectl get deployments'
alias kgn='kubectl get nodes'
alias kd='kubectl describe'
alias kdel='kubectl delete'
alias kl='kubectl logs -f'
alias kx='kubectx'
alias kns='kubens'
alias kaf='kubectl apply -f'
alias kdf='kubectl delete -f'

# Helm
alias h='helm'
alias hl='helm list'
alias hi='helm install'
alias hu='helm upgrade'
alias hd='helm delete'
alias hs='helm status'

# Docker
alias d='docker'
alias dc='docker compose'
alias dps='docker ps'
alias dpsa='docker ps -a'
alias di='docker images'
alias dex='docker exec -it'
alias dlogs='docker logs -f'

# Git (Oh-My-Zsh git plugin already has many, but here are extras)
alias gst='git status'
alias gcm='git commit -m'
alias glog='git log --oneline --graph --decorate --all'
alias gdiff='git diff'

# AWS
alias awsp='export AWS_PROFILE=$(aws configure list-profiles | fzf)'
alias awswho='aws sts get-caller-identity'

# System
alias c='clear'
alias reload='exec zsh'
alias path='echo $PATH | tr ":" "\n"'

# Chezmoi
alias cm='chezmoi'
alias cma='chezmoi apply'
alias cme='chezmoi edit'
alias cmd='chezmoi diff'
alias cms='chezmoi status'

# Utility
alias grep='grep --color=auto'
alias mkdir='mkdir -pv'
alias df='df -h'
alias du='du -h'
alias free='free -h'

# Safety
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

eval "$(ssh-agent -s)" > /dev/null
ssh-add ~/.ssh/github 2>/dev/null
ssh-add ~/.ssh/gitlab 2>/dev/null

# Shell integrations
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
eval "$(mise activate zsh)"
eval "$(zoxide init --cmd cd zsh)"
